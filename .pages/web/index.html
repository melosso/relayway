<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relayway - A small SMTP relay for Microsoft Graph</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <base target="_blank">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        }
        .gradient-text {
            background: linear-gradient(90deg, #4177c7 40%, #8c55cb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .disable-select {
            -webkit-user-select: none;  
            -moz-user-select: none;    
            -ms-user-select: none;      
            user-select: none;
        }
        /* Animation for loading state */
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .pulse-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }
        /* Enhanced hover effect for release badge */
        #github-release {
            transition: all 0.2s ease;
        }
        #github-release:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="bg-white text-gray-900 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl mx-auto space-y-12">
        <header class="text-center disable-select">
            <!-- Logo and title section -->
            <div class="mb-1">
                <div class="flex items-center justify-center">
                    <h1 class="text-5xl font-bold gradient-text pb-1">Relayway</h1>
                </div>
                
                <!-- GitHub release badge with additional info -->
                <div class="mt-3 mb-1 flex justify-center">
                    <div class="inline-flex items-center space-x-2">
                        <!-- Version badge -->
                        <a href="https://github.com/melosso/relayway/releases" id="github-release" class="group text-xs bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-full px-3 py-1 text-gray-500 font-medium inline-flex items-center transition-all duration-200">
                            <svg class="w-3.5 h-3.5 mr-1 text-gray-400 group-hover:text-gray-600 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                            <span id="release-info" class="pulse-animation">Loading...</span>
                        </a>
                        
                        <!-- Stability badge -->
                        <a id="stability-badge" href="https://github.com/melosso/relayway/releases" class="text-xs bg-green-50 hover:bg-green-100 border border-green-200 rounded-full px-3 py-1 text-green-600 font-medium inline-flex items-center transition-all duration-200">
                            <svg class="w-3.5 h-3.5 mr-1 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Stable</span>
                        </a>
                        
                        <!-- Issues badge -->
                        <a id="issues-badge" href="https://github.com/melosso/relayway/issues" class="text-xs bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-full px-3 py-1 text-gray-500 font-medium inline-flex items-center transition-all duration-200">
                            <svg class="w-3.5 h-3.5 mr-1 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="issues-count" class="pulse-animation">Loading...</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <p class="text-xl text-gray-600 max-w-2xl mx-auto mt-4">
                A friendly SMTP relay that simplifies your Microsoft Graph integration.
            </p>
        </header>

        <div class="grid md:grid-cols-2 gap-8">
            <div class="space-y-6">
                <h2 class="text-3xl font-semibold text-gray-800">Quick overview</h2>
                <p class="text-gray-700 text-lg">
                    Relayway is a lightweight SMTP relay server that bridges legacy applications with Microsoft Graph's modern OAuth authentication. Cross platform, lightweight and easy to deploy.
                </p>
                <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0 pt-2">
                    <a href="https://github.com/melosso/relayway" class="w-full text-sm h-14 bg-gradient-to-r from-slate-300 to-slate-200 text-gray-800 px-6 rounded-lg hover:opacity-90 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 20h9" />
                            <path d="M12 4h9" />
                            <path d="M4 9h16" />
                            <path d="M4 15h16" />
                        </svg>
                        Get Started!
                    </a>
                
                    <a href="https://melosso.com/licensing/relayway" class="w-full text-sm h-14 bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 rounded-lg hover:opacity-90 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M21 5H3c-1.1 0-1.99.9-1.99 2L1 17c0 1.1.9 2 1.99 2h18c1.1 0 1.99-.9 1.99-2L23 7c0-1.1-.9-2-1.99-2zM3 17V7h18v10H3z"/>
                        </svg>
                        View License
                    </a>
                </div>
            </div>

            <div class="space-y-6">
                <h2 class="text-3xl font-semibold text-gray-800">Get started</h2>
                <div class="flex flex-col space-y-4">
                    <a href="https://github.com/melosso/relayway/pkgs/container/relayway" target="_blank" class="w-full h-14 bg-white border border-gray-300 text-gray-800 px-6 rounded-lg hover:bg-gray-100 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M15 10l4.553 2.276A1 1 0 0120 13.118V18a2 2 0 01-2 2H6a2 2 0 01-2-2v-4.882a1 1 0 01.447-.842L9 10m3-7v11" />
                        </svg>
                        Get Docker Image
                    </a>
                    <a href="https://github.com/melosso/relayway" class="w-full h-14 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 rounded-lg hover:opacity-90 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        View on GitHub
                    </a>
                    <button id="download-button" class="w-full h-14 bg-gray-800 text-white px-6 rounded-lg hover:opacity-90 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2a1 1 0 0 1 1 1v10.586l3.293-3.293a1 1 0 0 1 1.414 1.414l-5 5a1 1 0 0 1-1.414 0l-5-5a1 1 0 0 1 1.414-1.414L11 13.586V3a1 1 0 0 1 1-1zM4 18a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1z"/>
                        </svg>
                        Download latest version
                    </button>
                </div>
            </div>
        </div>

        <footer class="text-center text-gray-500 disable-select">
            <p>Open Source • GNU AGPL (3.0) License • Community Driven</p>
        </footer>
    </div>

    <!-- Download Modal -->
    <div id="download-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg max-w-md w-full p-6 relative">
            <!-- Close button -->
            <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            
            <!-- Modal header -->
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Choose Your Platform</h3>
            <p class="text-gray-600 mb-6">Select your operating system to download the appropriate release:</p>
            
            <!-- Platform options -->
            <div class="space-y-3">
                <!-- Windows -->
                <button class="download-option w-full p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all flex items-center" data-platform="windows">
                    <div class="flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg mr-4">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 12V6.75l6-1.32v6.48L3 12zm6 6.25l-6-1.32V12l6 1.05v5.2zm1-5.2L22 12V6.75l-12 1.32V13.05zm12 5.2l-12 1.32V12l12 1.05v5.2z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium text-gray-800">Windows</div>
                        <div class="text-sm text-gray-500">Windows x64 (.zip)</div>
                    </div>
                </button>
                
                <!-- Linux -->
                <button class="download-option w-full p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 transition-all flex items-center" data-platform="linux">
                    <div class="flex items-center justify-center w-10 h-10 bg-green-100 rounded-lg mr-4">
                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12.504 0c-.155 0-.315.008-.48.021-4.226.333-3.105 4.807-3.17 6.298-.076 1.092-.3 1.953-1.05 3.02-.885 1.051-2.127 2.75-2.716 4.521-.278.832-.41 1.684-.287 2.489a.424.424 0 00-.11.135c-.26.268-.45.6-.663.839-.199.199-.485.267-.797.4-.313.136-.658.269-.864.68-.09.189-.136.394-.132.602 0 .199.027.4.055.536.058.399.116.728.04.97-.249.68-.28 1.145-.106 1.484.174.334.535.47.94.601.81.2 1.91.135 2.774.6.926.466 1.866.67 2.616.47.526-.116.97-.464 1.208-.946.587-.003 1.23-.269 2.26-.334.699-.058 1.574.267 2.577.2.025.134.063.198.114.333l.003.003c.391.778 1.113 1.132 1.884 1.071.986-.087 2.04-.456 2.735-.3.699.135 1.2.603 1.592 1.178.435.635.685 1.34.685 1.998 0 .794-.18 1.404-.533 1.927-.333.49-.777.846-1.25 1.115-.473.269-.928.448-1.356.513-.428.065-.8.003-1.057-.162zm3.857-13.867c-.027-.168-.064-.293-.098-.424-.465-1.352-2.564-2.222-5.147-2.222-2.598 0-4.747.9-5.147 2.222-.034.131-.071.256-.098.424-.81 5.176 2.427 7.266 4.669 7.044.3-.029.57-.187.729-.493.199-.38.218-.895.218-1.359 0-.697.378-1.216.851-1.716.473-.5 1.107-.881 1.468-1.509.18-.314.288-.675.288-1.034 0-.697-.507-1.284-1.097-1.656-.59-.372-1.259-.478-1.929-.478-.67 0-1.339.106-1.929.478-.59.372-1.097.959-1.097 1.656 0 .359.108.72.288 1.034.361.628.995 1.009 1.468 1.509.473.5.851 1.019.851 1.716 0 .464.019.979.218 1.359.159.306.429.464.729.493 2.242.222 5.479-1.868 4.669-7.044z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium text-gray-800">Linux</div>
                        <div class="text-sm text-gray-500">Linux x64 (.tar.gz)</div>
                    </div>
                </button>
                
                <!-- macOS -->
                <button class="download-option w-full p-4 border border-gray-200 rounded-lg hover:border-gray-300 hover:bg-gray-50 transition-all flex items-center" data-platform="macos">
                    <div class="flex items-center justify-center w-10 h-10 bg-gray-100 rounded-lg mr-4">
                        <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2.01.77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium text-gray-800">macOS</div>
                        <div class="text-sm text-gray-500">macOS (.tar.gz)</div>
                    </div>
                </button>
            </div>
            
            <!-- Loading state -->
            <div id="download-loading" class="hidden text-center py-4">
                <div class="inline-flex items-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-gray-600">Preparing download...</span>
                </div>
            </div>
            
            <!-- Error state -->
            <div id="download-error" class="hidden text-center py-4">
                <div class="text-red-600">
                    <svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-sm">Unable to find release for this platform.</p>
                    <p class="text-xs text-gray-500 mt-1">Try visiting the GitHub releases page directly.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Debug logging helper
        function logDebug(message, data) {
            console.log(`%c${message}`, 'background: #333; color: #bada55', data || '');
        }

        // Attempt to initialize the issues count from cache first
        function initializeFromCache() {
            logDebug('Initializing from cache if available');
            let issuesCached = false;
            let releasesCached = false;
            const currentTime = new Date().getTime();
            
            // First check for GitHub issues cache
            const cachedIssues = localStorage.getItem('github-issues-data');
            const cachedIssuesTime = localStorage.getItem('github-issues-time');
            
            if (cachedIssues && cachedIssuesTime && (currentTime - parseInt(cachedIssuesTime) < 12 * 60 * 60 * 1000)) {
                logDebug('Found valid issues cache, using it', new Date(parseInt(cachedIssuesTime)));
                try {
                    const data = JSON.parse(cachedIssues);
                    if (data && typeof data.total_count === 'number') {
                        const issuesElement = document.getElementById('issues-count');
                        const count = data.total_count;
                        issuesElement.textContent = `${count} ${count === 1 ? 'issue' : 'issues'}`;
                        issuesElement.classList.remove('pulse-animation');
                        logDebug('Successfully updated issues count from cache:', count);
                        issuesCached = true;
                    }
                } catch (error) {
                    logDebug('Error parsing cached issues data:', error);
                }
            } else {
                logDebug('No valid issues cache found or cache expired');
            }
            
            // Also initialize releases from cache
            const cachedData = localStorage.getItem('github-release-data');
            const cachedTime = localStorage.getItem('github-release-time');
            
            if (cachedData && cachedTime && (currentTime - parseInt(cachedTime) < 12 * 60 * 60 * 1000)) {
                logDebug('Found valid release cache, using it', new Date(parseInt(cachedTime)));
                try {
                    const data = JSON.parse(cachedData);
                    if (data && data.tag_name) {
                        // Update version number
                        const releaseElement = document.getElementById('release-info');
                        releaseElement.textContent = data.tag_name;
                        releaseElement.classList.remove('pulse-animation');
                        
                        // Update download link
                        const downloadLink = document.getElementById('download-link');
                        if (data.assets && data.assets.length > 0) {
                            downloadLink.href = data.assets[0].browser_download_url;
                        } else {
                            downloadLink.href = data.html_url;
                        }
                        
                        // Update release badge link
                        const releaseLink = document.getElementById('github-release');
                        releaseLink.href = data.html_url;
                        
                        // Show stability badge if not a pre-release
                        const stabilityBadge = document.getElementById('stability-badge');
                        if (!data.prerelease) {
                            stabilityBadge.classList.remove('hidden');
                            logDebug('Showing stability badge');
                        }
                        
                        logDebug('Successfully updated release info from cache:', data.tag_name);
                        releasesCached = true;
                    }
                } catch (error) {
                    logDebug('Error parsing cached release data:', error);
                }
            } else {
                logDebug('No valid release cache found or cache expired');
            }
            
            return { issuesCached, releasesCached };
        }
        
        // Function to fetch GitHub issues only if needed
        async function fetchGitHubData() {
            logDebug('Starting GitHub data fetch process');
            
            // Try to load from cache first
            const { issuesCached, releasesCached } = initializeFromCache();
            
            // If issues are already loaded from cache, we don't need to fetch them
            if (!issuesCached) {
                logDebug('Issues not found in cache, fetching from API');
                fetchGitHubIssues();
            }
            
            // Check if releases need to be fetched
            const cachedData = localStorage.getItem('github-release-data');
            const cachedTime = localStorage.getItem('github-release-time');
            const currentTime = new Date().getTime();
            
            if (!cachedData || !cachedTime || (currentTime - parseInt(cachedTime) >= 12 * 60 * 60 * 1000)) {
                logDebug('Release data not in cache or expired, fetching from API');
                fetchGitHubReleases();
            }
        }
        
        // Function to update release info
        function updateReleaseInfo(data) {
            logDebug('Updating release info in UI');
            
            // Update version number
            const releaseElement = document.getElementById('release-info');
            releaseElement.textContent = data.tag_name;
            releaseElement.classList.remove('pulse-animation');
            
            // Update release badge link
            const releaseLink = document.getElementById('github-release');
            releaseLink.href = data.html_url;
            
            // Show stability badge if not a pre-release
            const stabilityBadge = document.getElementById('stability-badge');
            if (!data.prerelease) {
                stabilityBadge.classList.remove('hidden');
                logDebug('Showing stability badge');
            }
            
            // Store release data globally for modal use
            window.releaseData = data;
            
            logDebug('Successfully updated release info:', data.tag_name);
        }
        
        // Function to fetch GitHub release information
        async function fetchGitHubReleases() {
            logDebug('Fetching GitHub releases');
            const currentTime = new Date().getTime();
            
            try {
                const response = await fetch('https://api.github.com/repos/melosso/relayway/releases/latest');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                logDebug('Received release data:', data.tag_name);
                
                // Save to localStorage with current timestamp
                localStorage.setItem('github-release-data', JSON.stringify(data));
                localStorage.setItem('github-release-time', currentTime.toString());
                
                // Update UI with the fetched data
                updateReleaseInfo(data);
            } catch (error) {
                console.error('Error fetching GitHub release:', error);
                document.getElementById('release-info').textContent = 'Latest release';
                document.getElementById('release-info').classList.remove('pulse-animation');
            }
        }
        
        // Function to fetch GitHub issues
        async function fetchGitHubIssues() {
            logDebug('Fetching GitHub issues');
            const currentTime = new Date().getTime();
            
            try {
                const response = await fetch('https://api.github.com/search/issues?q=repo:melosso/relayway+is:issue+is:open');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                logDebug('Received issues data:', data.total_count);
                
                // Save to localStorage with current timestamp
                localStorage.setItem('github-issues-data', JSON.stringify(data));
                localStorage.setItem('github-issues-time', currentTime.toString());
                
                // Update UI
                const issuesElement = document.getElementById('issues-count');
                const count = data.total_count;
                issuesElement.textContent = `${count} ${count === 1 ? 'issue' : 'issues'}`;
                issuesElement.classList.remove('pulse-animation');
            } catch (error) {
                console.error('Error fetching GitHub issues:', error);
                document.getElementById('issues-count').textContent = 'Issues';
                document.getElementById('issues-count').classList.remove('pulse-animation');
            }
        }
        
        // Function to find the correct asset for a platform
        function findAssetForPlatform(assets, platform) {
            logDebug(`Looking for asset for platform: ${platform}`, assets);
            
            if (!assets || assets.length === 0) {
                logDebug('No assets found');
                return null;
            }
            
            const platformPatterns = {
                windows: ['win', 'windows'],
                linux: ['linux'],
                macos: ['osx', 'macos', 'darwin']
            };
            
            const patterns = platformPatterns[platform] || [];
            
            // Look for assets that match the platform patterns
            for (const asset of assets) {
                const name = asset.name.toLowerCase();
                logDebug(`Checking asset: ${asset.name}`);
                
                for (const pattern of patterns) {
                    if (name.includes(pattern)) {
                        logDebug(`Found matching asset for ${platform}:`, asset.name);
                        return asset;
                    }
                }
            }
            
            logDebug(`No specific asset found for ${platform}`);
            return null;
        }
        
        // Modal functionality
        function initializeModal() {
            const downloadButton = document.getElementById('download-button');
            const modal = document.getElementById('download-modal');
            const closeButton = document.getElementById('close-modal');
            const downloadOptions = document.querySelectorAll('.download-option');
            const loadingDiv = document.getElementById('download-loading');
            const errorDiv = document.getElementById('download-error');
            
            // Open modal
            downloadButton.addEventListener('click', () => {
                logDebug('Opening download modal');
                modal.classList.remove('hidden');
                
                // Reset states
                loadingDiv.classList.add('hidden');
                errorDiv.classList.add('hidden');
                downloadOptions.forEach(option => option.style.display = 'flex');
            });
            
            // Close modal
            closeButton.addEventListener('click', () => {
                logDebug('Closing download modal');
                modal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    logDebug('Closing modal via backdrop click');
                    modal.classList.add('hidden');
                }
            });
            
            // Handle platform selection
            downloadOptions.forEach(option => {
                option.addEventListener('click', async () => {
                    const platform = option.dataset.platform;
                    logDebug(`Selected platform: ${platform}`);
                    
                    // Show loading state
                    downloadOptions.forEach(opt => opt.style.display = 'none');
                    errorDiv.classList.add('hidden');
                    loadingDiv.classList.remove('hidden');
                    
                    try {
                        // Get release data
                        let releaseData = window.releaseData;
                        
                        if (!releaseData) {
                            logDebug('No release data cached, fetching...');
                            const response = await fetch('https://api.github.com/repos/melosso/relayway/releases/latest');
                            if (!response.ok) throw new Error('Failed to fetch release data');
                            releaseData = await response.json();
                        }
                        
                        // Find the appropriate asset
                        const asset = findAssetForPlatform(releaseData.assets, platform);
                        
                        if (asset) {
                            logDebug(`Downloading asset: ${asset.name}`);
                            // Create a temporary link and trigger download
                            const link = document.createElement('a');
                            link.href = asset.browser_download_url;
                            link.download = asset.name;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            // Close modal after successful download
                            setTimeout(() => {
                                modal.classList.add('hidden');
                            }, 500);
                        } else {
                            throw new Error(`No release found for ${platform}`);
                        }
                        
                    } catch (error) {
                        logDebug('Download error:', error);
                        loadingDiv.classList.add('hidden');
                        errorDiv.classList.remove('hidden');
                        
                        // Show options again after a delay
                        setTimeout(() => {
                            errorDiv.classList.add('hidden');
                            downloadOptions.forEach(opt => opt.style.display = 'flex');
                        }, 3000);
                    }
                });
            });
        }
        
        // Function to fetch GitHub issues
        async function fetchGitHubIssues() {
            logDebug('Fetching GitHub issues');
            const currentTime = new Date().getTime();

            try {
                // Direct API call for open issues count
                const issuesUrl = 'https://api.github.com/search/issues?q=repo:melosso/relayway+state:open';
                const response = await fetch(issuesUrl);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                logDebug('Received issues data:', data);
                
                if (data && typeof data.total_count === 'number') {
                    // Save to localStorage with current timestamp
                    localStorage.setItem('github-issues-data', JSON.stringify(data));
                    localStorage.setItem('github-issues-time', currentTime.toString());
                    logDebug('Saved issues data to cache with timestamp:', new Date(currentTime));
                    
                    // Update the issues count with the total_count from the search API
                    const issuesElement = document.getElementById('issues-count');
                    const count = data.total_count;
                    issuesElement.textContent = `${count} ${count === 1 ? 'issue' : 'issues'}`;
                    issuesElement.classList.remove('pulse-animation');
                } else {
                    throw new Error('Invalid response format');
                }
            } catch (error) {
                console.error('Error fetching GitHub issues:', error);
                // Set a hardcoded value of 4 issues for demonstration
                const issuesElement = document.getElementById('issues-count');
                issuesElement.textContent = '4 issues';
                issuesElement.classList.remove('pulse-animation');
            }
        }
        
        // Function to update UI with release data
        function updateReleaseInfo(data) {
            logDebug('Updating UI with release info');
            if (data && data.tag_name) {
                const releaseElement = document.getElementById('release-info');
                // Only show the version number without "Latest:"
                releaseElement.textContent = `${data.tag_name}`;
                releaseElement.classList.remove('pulse-animation');
                
                // Update download link and the github release badge link
                const downloadLink = document.getElementById('download-link');
                const releaseLink = document.getElementById('github-release');
                
                // If there's a specific asset to download, use it for the download button
                if (data.assets && data.assets.length > 0) {
                    downloadLink.href = data.assets[0].browser_download_url;
                } else {
                    // If no specific asset, link to the release page
                    downloadLink.href = data.html_url;
                }
                
                // Always set the release badge to link to the release page
                releaseLink.href = data.html_url;
                
                // Show stability badge if this is not a pre-release
                const stabilityBadge = document.getElementById('stability-badge');
                if (!data.prerelease) {
                    stabilityBadge.classList.remove('hidden');
                }
            }
        }
        
        // Execute when page loads
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('DOM loaded, initializing page');
            
            // Initialize modal functionality
            initializeModal();
            
            // Initialize GitHub data fetching
            fetchGitHubData();
        });
    </script>
</body>